<% films.each do |film| %>
  <%= link_to film, style: "text-decoration: none; color: inherit;", data: { turbo_frame: "_top" } do %>
    <div class="film-card">
      <%= render 'shared/film_thumbnail', film: film, show_pending: (user_signed_in? && !film.published?), unique_id: "lazy-#{film.id}" %>
      <div class="film-info">
        <h3 class="film-title"><%= film.title %></h3>
        <div class="film-meta">
          <%# Display companies - check multi-company association first, then legacy fields %>
          <% company_names = film.companies_display_names %>
          <% if company_names.any? %>
            <div class="film-meta-row">
              <span class="film-company"><%= company_names.first(2).join(', ') %><%= company_names.count > 2 ? " +#{company_names.count - 2}" : '' %></span>
            </div>
          <% end %>
          <div class="film-meta-row">
            <% if film.release_date.present? %>
              <span><%= film.release_date.year %></span>
            <% end %>
            <%# Show runtime for all videos, not just uploaded ones %>
            <% if film.runtime.present? %>
              <span>· <%= film.formatted_runtime %></span>
            <% end %>
            <% if film.review_count > 0 %>
              <span class="film-card-rating">
                · ★ <%= number_with_precision(film.average_rating, precision: 1) %> (<%= film.review_count %>)
              </span>
            <% end %>
          </div>
          <% if film.riders.any? %>
            <div class="film-riders">
              <% film.riders.limit(5).each do |rider| %>
                <span class="rider-tag"><%= rider.username %></span>
              <% end %>
              <% if film.riders.count > 5 %>
                <span class="rider-tag">+<%= film.riders.count - 5 %></span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
