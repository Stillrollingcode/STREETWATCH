<% users.each do |user| %>
  <div class="profile-card">
    <div class="profile-card-content">
      <%= link_to user_path(user), style: "text-decoration: none; color: inherit; display: block;" do %>
        <div class="profile-card-header">
          <div class="profile-avatar">
            <% if user.avatar.attached? %>
              <%= image_tag user.avatar, alt: user.username.presence || user.email %>
            <% else %>
              <%= (user.username.presence || user.email).first&.upcase %>
            <% end %>
          </div>
          <div class="profile-info">
            <div class="profile-name"><%= user.name.presence || user.username.presence || user.email %></div>
            <div class="profile-username">@<%= user.username.presence || user.email %></div>
            <% if user.profile_type == 'company' || user.profile_type == 'crew' %>
              <span class="profile-type-label"><%= user.profile_type %></span>
            <% end %>
            <% if user.bio.present? %>
              <div class="profile-bio"><%= user.bio %></div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <% if user_signed_in? %>
      <% if current_user.id != user.id %>
        <div class="profile-card-actions">
          <% if current_user.following?(user) %>
            <%= button_to unfollow_user_path(user), method: :delete, class: "support-btn active", form: { style: "display: inline; width: 100%;" } do %>
              âœ“ Supported
            <% end %>
          <% else %>
            <%= button_to follow_user_path(user), method: :post, class: "support-btn", form: { style: "display: inline; width: 100%;" } do %>
              + Support
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
