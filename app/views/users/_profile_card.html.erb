<%
  show_support = user_signed_in? && current_user.id != profile_card.id
  show_profile_type = profile_card.profile_type == 'company' || profile_card.profile_type == 'crew'
  show_actions = show_support || show_profile_type
%>
<div class="profile-card">
  <div class="profile-card-top">
    <%= link_to user_path(profile_card), class: "profile-card-link" do %>
      <div class="profile-avatar">
        <% if profile_card.avatar.attached? %>
          <%= image_tag profile_card.avatar, alt: profile_card.username.presence || profile_card.email %>
        <% else %>
          <%= (profile_card.username.presence || profile_card.email).first&.upcase %>
        <% end %>
      </div>
      <div class="profile-info">
        <div class="profile-name"><%= profile_card.name.presence || profile_card.username.presence || profile_card.email %></div>
        <div class="profile-username">@<%= profile_card.username.presence || profile_card.email %></div>
      </div>
    <% end %>
    <% if show_actions %>
      <div class="profile-card-actions">
        <% if show_support %>
          <% if following_ids.include?(profile_card.id) %>
            <%= button_to unfollow_user_path(profile_card), method: :delete, class: "support-btn active", form: { style: "display: inline; width: 100%;", data: { follow_toggle: true, follow_url: follow_user_path(profile_card), unfollow_url: unfollow_user_path(profile_card), following: true } } do %>
              âœ“ Supported
            <% end %>
          <% else %>
            <%= button_to follow_user_path(profile_card), method: :post, class: "support-btn", form: { style: "display: inline; width: 100%;", data: { follow_toggle: true, follow_url: follow_user_path(profile_card), unfollow_url: unfollow_user_path(profile_card), following: false } } do %>
              + Support
            <% end %>
          <% end %>
        <% end %>
        <% if show_profile_type %>
          <span class="profile-type-label"><%= profile_card.profile_type %></span>
        <% end %>
      </div>
    <% end %>
  </div>
  <% if profile_card.bio.present? %>
    <div class="profile-bio"><%= profile_card.bio %></div>
  <% end %>
</div>
