<% content_for :head do %>
  <% theme = user_theme_styles %>
  <style>
    .albums-shell {
      max-width: 1200px;
      margin: 28px auto 60px;
      padding: 0 18px 40px;
      color: var(--text);
    }
    .albums-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .albums-header h1 {
      margin: 0 0 16px;
      font-size: 32px;
      letter-spacing: 0.01em;
    }
    .filters-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 12px;
      flex-wrap: wrap;
    }
    .search-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }
    .search-box input {
      width: 100%;
      padding: 10px 12px 10px 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      font-size: 14px;
    }
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
    }
    .sort-select {
      padding: 10px 32px 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
    }
    .albums-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    .album-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.2s ease;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .album-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0,0,0,0.4);
      border-color: <%= theme[:primary_rgba].sub('ALPHA', '0.3') %>; /* Fallback for Chrome <111 */
      border-color: color-mix(in srgb, var(--accent) 30%, transparent);
    }
    .album-cover {
      width: 100%;
      aspect-ratio: 16/10;
      background: linear-gradient(135deg, <%= theme[:primary_rgba].sub('ALPHA', '0.2') %>, <%= theme[:secondary_rgba].sub('ALPHA', '0.2') %>); /* Fallback for Chrome <111 */
      background: linear-gradient(135deg, color-mix(in srgb, var(--accent) 20%, transparent), color-mix(in srgb, var(--accent-2) 20%, transparent));
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .album-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .album-photo-count {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }
    .album-info {
      padding: 20px;
    }
    .album-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0 0 8px;
      color: var(--text);
    }
    .album-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .album-description {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .create-album-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 14px 24px;
      border-radius: 12px;
      background: var(--accent);
      color: white;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: all 0.2s;
      z-index: 100;
    }
    .create-album-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }
  </style>
<% end %>

<div class="albums-shell">
  <div class="albums-header">
    <h1>Albums</h1>
  </div>

  <div class="filters-bar">
    <div class="search-box">
      <%= form_with url: albums_path, method: :get, local: true do |f| %>
        <span class="search-icon">üîç</span>
        <%= f.text_field :search, placeholder: "Search albums...", value: params[:search] %>
        <%= f.hidden_field :sort, value: params[:sort] if params[:sort] %>
      <% end %>
    </div>

    <div class="sort-controls">
      <%= form_with url: albums_path, method: :get, local: true do |f| %>
        <%= f.select :sort,
          [['Newest', 'newest'], ['Oldest', 'oldest'], ['Alphabetical', 'alphabetical'], ['By Date', 'by_date']],
          { selected: params[:sort] || 'newest' },
          { class: 'sort-select', onchange: 'this.form.submit()' }
        %>
        <%= f.hidden_field :search, value: params[:search] if params[:search] %>
      <% end %>
    </div>
  </div>

  <div class="albums-grid">
    <% @albums.each do |album| %>
      <%= link_to album, class: 'album-card' do %>
        <div class="album-cover">
          <% if album.photos.any? && album.photos.first.image.attached? %>
            <%= image_tag url_for(album.photos.first.image), alt: album.title %>
          <% else %>
            <div style="font-size: 64px; opacity: 0.2;">üì∑</div>
          <% end %>
          <div class="album-photo-count">
            <%= pluralize(album.photos.count, 'photo') %>
          </div>
        </div>
        <div class="album-info">
          <h3 class="album-title"><%= album.title %></h3>
          <div class="album-meta">
            <span><%= album.user.name %></span>
            <% if album.date %>
              <span>‚Ä¢</span>
              <span><%= album.date.strftime("%b %Y") %></span>
            <% end %>
          </div>
          <% if album.description.present? %>
            <p class="album-description"><%= album.description %></p>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>

  <% if defined?(Kaminari) && @albums.respond_to?(:total_pages) %>
    <%= paginate @albums %>
  <% end %>

  <% if user_signed_in? %>
    <%= link_to "Create Album", new_album_path, class: "create-album-btn" %>
  <% end %>
</div>
